{"version":3,"file":"static/js/332.9bbb1eef.chunk.js","mappings":"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","sources":["layouts/FarmManagement/ManageClusters.jsx"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  useMemo,\n  // useRef,\n  useCallback,\n} from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useNavigate } from \"react-router-dom\";\n\nimport Stack from \"@mui/material/Stack\";\nimport Box from \"@mui/material/Box\";\nimport IconButton from \"@mui/material/IconButton\";\n// import Tooltip from \"@mui/material/Tooltip\";\n\nimport { BiEditAlt as EditIcon } from \"react-icons/bi\";\nimport { AiOutlineEye as ViewIcon } from \"react-icons/ai\";\n\nimport Table from \"../../components/Table/UserTable\";\nimport TableControls from \"../../components/Table/TableControls\";\nimport BreadCrumb from \"../../components/common/CustomBreadCrumbs\";\nimport Button from \"../../components/common/Button\";\nimport Spinner from \"../../components/Spinner\";\n\nimport {\n  AddCluster as AddClusterModalContent,\n  EditCluster as EditClusterModalContent,\n} from \"./ModalContents\";\nimport Dialog from \"../../components/Modals/Dialog\";\n\nimport { getClusters } from \"../../redux/actions/FarmManagementActions\";\nimport { Typography } from \"@mui/material\";\nimport axiosServices from \"../../services/axiosServices\";\nimport Can from \"../../utils/rbac/Can\";\n\nfunction ManageClusters() {\n  const navigate = useNavigate();\n  const [page, setPage] = useState(1);\n  const [limit, setLimit] = useState(10);\n  const [roles, setRoles] = useState({});\n  // const [query, setQuery] = useState(\"\");\n\n  // const queryRef = useRef(null);\n\n  const authenticatedUser = useSelector(\n    (state) =>\n      state.AuthReducer.userProfile ||\n      JSON.parse(sessionStorage.getItem(\"user_profile\"))\n  );\n\n  const clusters = useSelector(\n    (state) => state.FarmMangementReducer.clusters?.data\n  );\n\n  const isLoading = useSelector(\n    (state) => state.FarmMangementReducer.clusters?.loading || false\n  );\n\n  const [dialogContent, setDialogContent] = useState(null);\n  const [showModal, setShowModal] = useState(false);\n\n  const handleModalClose = () => {\n    setShowModal(false);\n  };\n\n  const handleModalOpen = useCallback(\n    (modalId, data = null) =>\n      (e) => {\n        switch (modalId) {\n          case \"add-cluster\":\n            // console.log(data);\n            setDialogContent(\n              <AddClusterModalContent\n                closeHandler={handleModalClose}\n                roles={roles}\n              />\n            );\n            break;\n\n          case \"edit-cluster\":\n            setDialogContent(\n              <EditClusterModalContent\n                closeHandler={handleModalClose}\n                data={data}\n                roles={roles}\n              />\n            );\n            break;\n\n          default:\n            setDialogContent(null);\n            break;\n        }\n        setShowModal(true);\n      },\n    [roles]\n  );\n\n  // onChange function for select\n  const handleLimitChange = (e) => {\n    setLimit(parseInt(e.target.value));\n  };\n\n  const setPrev = () => {\n    if (page > 1) setPage(page - 1);\n  };\n\n  const setNext = () => {\n    setPage(page + 1);\n  };\n\n  const columns = useMemo(\n    () => [\n      {\n        Header: \"S/N\",\n        accessor: \"serial\",\n      },\n      {\n        Header: \"Name\",\n        accessor: \"name\",\n      },\n      {\n        Header: \"Description\",\n        accessor: \"description\",\n      },\n      {\n        Header: \"Manager\",\n        Cell: ({ value, row }) => {\n          const { original } = row;\n          return (\n            <span>{`${original.manager?.first_name} ${original.manager?.last_name}`}</span>\n          );\n        },\n      },\n      {\n        Header: \"Cluster ID\",\n        accessor: \"cluster_id\",\n      },\n      {\n        Header: \"Cluster Size\",\n        Cell: ({ value, row }) => {\n          const { original } = row;\n          return (\n            <span>\n              {!original.farms_sum_size ? \"-\" : `${original.farms_sum_size}`}\n            </span>\n          );\n        },\n      },\n      {\n        Header: \"View\",\n        Cell: ({ value, row }) => {\n          const { original } = row;\n          // console.log(original);\n          return (\n            <IconButton\n              onClick={() => {\n                navigate(`/farm-management/clusters/${original.id}`);\n                // tableActionsHandler(`Viewing Cluster: ${original.cluster_id}...`);\n              }}\n            >\n              <ViewIcon />\n            </IconButton>\n          );\n        },\n      },\n      {\n        Header: \"Edit\",\n        Cell: ({ value, row }) => {\n          const { original } = row;\n          // console.log(original);\n          return (\n            <Can\n              role={authenticatedUser?.my_role?.role}\n              perform=\"farm-management:cluster:edit\"\n              yes={() => (\n                <IconButton onClick={handleModalOpen(\"edit-cluster\", original)}>\n                  <EditIcon />\n                </IconButton>\n              )}\n              no={() => (\n                null\n                // <Tooltip\n                //   title={`${authenticatedUser?.my_role?.role} cannot perform this action`}\n                // >\n                //   <IconButton>\n                //     <EditIcon />\n                //   </IconButton>\n                // </Tooltip>\n              )}\n            />\n          );\n        },\n      },\n    ],\n    [authenticatedUser?.my_role?.role, handleModalOpen, navigate]\n  );\n\n  const tableData = useMemo(() => (clusters || []).map((each, index) => {\n    return {\n      ...each,\n      serial: index + page\n    }\n  }), [clusters, page]);\n\n  const fetchRoles = useCallback(async () => {\n    try {\n      // console.log(\"fetching roles\");\n      const res = await axiosServices.get(\"/all/roles\");\n      if (res?.result?.roles) {\n        setRoles((state) => {\n          const r = {};\n\n          res?.result?.roles.forEach((role) => {\n            r[role.role] = role.id;\n          });\n\n          return r;\n        });\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }, []);\n\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    fetchRoles();\n    dispatch(getClusters());\n  }, [dispatch, fetchRoles]);\n\n  return (\n    <React.Fragment>\n      <section>\n        <nav id=\"quick-nav\">\n          <BreadCrumb\n            breadcrumbs={[\n              <Typography key=\"1\" color=\"inherit\">\n                Farm Management\n              </Typography>,\n              <Typography key=\"2\" color=\"primary.main\">\n                Farm Clusters\n              </Typography>,\n            ]}\n          />\n        </nav>\n\n        <Stack\n          direction=\"row\"\n          justifyContent=\"space-between\"\n          alignItems=\"center\"\n        >\n          <h2 className=\"with-spinner\" style={{ fontSize: \"20px\" }}>\n            <span>All Clusters</span>\n            {isLoading ? <Spinner size={20} color=\"primary\" /> : \"\"}\n          </h2>\n\n          <Stack direction=\"row\" spacing={2}>\n            <Can\n              role={authenticatedUser?.my_role?.role}\n              perform=\"farm-management:cluster:create\"\n              yes={() => (\n                <Button\n                  onClick={handleModalOpen(\"add-cluster\")}\n                  value=\"Add New Cluster\"\n                  disableElevation\n                />\n              )}\n              no={() => null}\n            />\n          </Stack>\n        </Stack>\n\n        <Box>\n          <Table columns={columns} data={tableData} isLoading={isLoading} />\n          <TableControls\n            nextHandler={() => setNext()}\n            prevHandler={() => setPrev()}\n            limitHandler={(e) => handleLimitChange(e)}\n            totalRecords={clusters.length}\n            limit={clusters.length || limit}\n            page={page}\n          />\n        </Box>\n      </section>\n\n      <Dialog open={showModal} closeHandler={handleModalClose}>\n        {dialogContent}\n      </Dialog>\n    </React.Fragment>\n  );\n}\n\nexport default ManageClusters;\n"],"names":["navigate","useNavigate","useState","page","setPage","limit","setLimit","roles","setRoles","authenticatedUser","useSelector","state","AuthReducer","userProfile","JSON","parse","sessionStorage","getItem","clusters","FarmMangementReducer","data","isLoading","loading","dialogContent","setDialogContent","showModal","setShowModal","handleModalClose","handleModalOpen","useCallback","modalId","e","closeHandler","columns","useMemo","Header","accessor","Cell","value","original","row","manager","first_name","last_name","farms_sum_size","onClick","id","role","my_role","perform","yes","no","tableData","map","each","index","serial","fetchRoles","axiosServices","res","result","r","forEach","console","log","dispatch","useDispatch","useEffect","getClusters","breadcrumbs","color","direction","justifyContent","alignItems","className","style","fontSize","size","spacing","disableElevation","nextHandler","prevHandler","limitHandler","parseInt","target","handleLimitChange","totalRecords","length","open"],"sourceRoot":""}